<!-- showing graph using jsGraph -->

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <script language="javascript" src="./jsgraph.min.js"></script>
  </head>

  <body>
    <table id="target" border="1" style="border-collapse: collapse;">
      <tr>
        <th>Multiplet</th>
        <th>Error function</th>
      </tr>
    </table>

    <script>
      /*const options = {
        // options for zoom
        plugins: {
          zoom: {
            zoomMode: 'xy',
          },
        },
        mouseActions: [
          {
            plugin: 'zoom',
            shift: false,
            ctrl: false,
          },
          {
            plugin: 'zoom',
            type: 'mousewheel',
            options: {
              direction: 'y',
            },
          },
          {
            plugin: 'zoom',
            type: 'dblclick',
            options: {
              mode: 'total',
            },
          },
        ],
      };*/

      createGraph();

      async function createGraph() {
        let options = {
          width: 400,
          height: 150,
          plugins: {
          zoom: {
            zoomMode: 'xy',
          },
        },
        mouseActions: [
          {
            plugin: 'zoom',
            shift: false,
            ctrl: false,
          },
          {
            plugin: 'zoom',
            type: 'mousewheel',
            options: {
              direction: 'y',
            },
          },
          {
            plugin: 'zoom',
            type: 'dblclick',
            options: {
              mode: 'total',
            },
          },
        ],
        };

        let response = await fetch('./result.json');
        let result = await response.json();

        let steps = result.debug.steps;
        let id = 0;

        for (let step of steps) {
          console.log(step);
          id++;
          let tr = document.createElement('TR');
          let tdMultiplet = document.createElement('TD');
          tdMultiplet.setAttribute('id', 'multiplet' + id);
          tr.appendChild(tdMultiplet);

          let tdErrorFunction = document.createElement('TD');
          tdErrorFunction.setAttribute('id', 'errorFunction' + id);
          tr.appendChild(tdErrorFunction);

          document.getElementById('target').appendChild(tr);

          addMultiplet('multiplet' + id, step.multiplet, options);
          addErrorFunction('errorFunction' + id, step.errorFunction, options);

          continue;
        }
      }

      function addMultiplet(id, data, options = {}) {
        const { width = 400, height = 250 } = options;
        let graph = new Graph(id, options);
        graph.resize(width, height); // Resizes the container
        let waveForm = Graph.newWaveform();
        waveForm.setData(data.y, data.x);
        graph
          .newSerie('line serie', {}, 'line') // Creates a new serie
          .autoAxis() // Assigns axes
          .setWaveform(waveForm)
          .setLineColor('blue');
        graph.draw(); // Draw
      }

      function addErrorFunction(id, data, options = {}) {
        const { width = 400, height = 250 } = options;
        let graph = new Graph(id, options);
        graph.resize(width, height); // Resizes the container
        let waveForm = Graph.newWaveform();
        waveForm.setData(data.y, data.x);
        graph
          .newSerie('line serie', {}, 'line') // Creates a new serie
          .autoAxis() // Assigns axes
          .setWaveform(waveForm)
          .setLineColor('red');
        graph.draw(); // Draw
      }
    </script>
  </body>
</html>
